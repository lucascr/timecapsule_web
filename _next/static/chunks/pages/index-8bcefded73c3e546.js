(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(7246)}])},7246:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return l}});var a=n(5893),r=n(3487),o=n(7294),s=n(1664),i=n.n(s);function l(){let{session:e,login:t,logout:n}=(0,r.k)(),[s,l]=(0,o.useState)(""),[c,d]=(0,o.useState)(""),[p,u]=(0,o.useState)(""),[h,g]=(0,o.useState)(""),[x,f]=(0,o.useState)(""),[y,m]=(0,o.useState)(""),[w,S]=(0,o.useState)(!1),[v,j]=(0,o.useState)(!1);(0,o.useEffect)(()=>{e&&b()},[e]);let b=async()=>{try{var t,n;if(!e||!e.actor)throw Error("Session or actor is not defined.");let a=null!==(n=null===(t=e.actor)||void 0===t?void 0:t.toString())&&void 0!==n?n:"default_actor",r=await _(a+" 0");j(!0);let o=await fetch("https://wax-testnet.eosphere.io/v1/chain/get_table_rows",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:"hashtesttest",scope:"hashtesttest",table:"idtable",index_position:"6",json:!0,key_type:"sha256",encode_type:"hex",upper_bound:r,lower_bound:r})}),s=await o.json();console.log("id:"+JSON.stringify(s,null,2)),s.rows&&s.rows.length>0?(S(!0),d(s.rows[0].id.toString())):(S(!1),d("")),j(!1)}catch(e){console.error("Error checking available ID:",e),S(!1),j(!1)}};async function _(e){let t=new TextEncoder().encode(e);return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>e.toString(16).padStart(2,"0")).join("")}let k=async()=>{if(e)try{let t={account:"hashtesttest",name:"generateid",authorization:[{actor:e.actor,permission:"active"}],data:{user:e.actor}};await e.transact({actions:[t]}),setTimeout(async()=>{await b()},5e3)}catch(e){console.error("Error generating ID:",e),alert("Failed to generate ID")}},C=(e,t)=>{if(!t)return e;let n=t.length,a="";for(let r=0;r<e.length;r++)a+=String.fromCharCode(e.charCodeAt(r)^t.charCodeAt(r%n));return a},D=e=>{let t=C(e,c);return btoa(String.fromCharCode(...new TextEncoder().encode(t)))},E=async()=>{if(!e||!s.trim())return;if(!c){alert("Please enter a password to encrypt your message");return}if(!p){alert("Please select a release date");return}let t=Math.floor(new Date(p).getTime()/1e3);Date.now();try{var n;let a=D(s.trim()),r={account:"hashtesttest",name:"sendmsg",authorization:[{actor:e.actor,permission:"active"}],data:{user:e.actor,message:a}},o=await e.transact({actions:[r]});if(!(null===(n=o.response)||void 0===n?void 0:n.transaction_id))throw Error("No transaction ID received");let i=o.response.transaction_id;console.log("Transaction hash:",i),console.log("Release_date:",t);let c={account:"hashtesttest",name:"saveid",authorization:[{actor:e.actor,permission:"active"}],data:{user:e.actor,str_hash:i.toString(),release_date:t}};await e.transact({actions:[c]}),l(""),u(""),d(""),S(!1),alert("Message sent successfully! Generate a new ID to send another message.")}catch(e){console.error("Error sending message:",e),alert("Failed to send message")}},T=new Date;T.setDate(T.getDate()+1);let z=T.toISOString().split("T")[0];return(0,a.jsxs)("div",{style:{padding:"20px"},children:[(0,a.jsx)("h1",{children:"TimeCapsule"}),e?(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{children:["Logged in as: ",e.actor.toString()]}),w?(0,a.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,a.jsx)("input",{type:"password",value:c,readOnly:!0,style:{width:"100%",padding:"10px",marginBottom:"10px",backgroundColor:"#f0f0f0"},placeholder:"Your ID hash..."}),(0,a.jsx)("textarea",{value:s,onChange:e=>l(e.target.value),style:{width:"100%",minHeight:"100px",padding:"10px",marginBottom:"10px"},placeholder:"Enter your message..."}),(0,a.jsxs)("div",{style:{marginBottom:"10px"},children:[(0,a.jsx)("label",{style:{display:"block",marginBottom:"5px"},children:"Release Date:"}),(0,a.jsx)("input",{type:"date",value:p,onChange:e=>u(e.target.value),min:z,style:{width:"100%",padding:"10px"}})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:"10px"},children:[(0,a.jsx)("button",{onClick:E,style:{padding:"10px 20px",fontSize:"16px",cursor:"pointer"},children:"Send Message"}),(0,a.jsx)(i(),{href:"/messages",style:{padding:"10px 20px",fontSize:"16px",cursor:"pointer",backgroundColor:"#f0f0f0",textDecoration:"none",color:"black",display:"inline-block"},children:"View Messages"}),(0,a.jsx)("button",{onClick:n,style:{padding:"10px 20px",fontSize:"16px",cursor:"pointer"},children:"Logout"})]})]}):(0,a.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,a.jsx)("p",{children:"You need to generate an ID before sending messages."}),(0,a.jsxs)("div",{style:{display:"flex",gap:"10px"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("button",{onClick:k,style:{padding:"10px 20px",fontSize:"16px",cursor:"pointer"},children:"Generate ID"}),v&&(0,a.jsx)("p",{children:"Waiting for TX confirmation..."})]}),(0,a.jsx)("div",{children:(0,a.jsx)(i(),{href:"/messages",style:{padding:"10px 20px",fontSize:"16px",cursor:"pointer",backgroundColor:"#f0f0f0",textDecoration:"none",color:"black",display:"inline-block"},children:"View Messages"})})]})]}),!1]}):(0,a.jsx)("button",{onClick:t,style:{padding:"10px 20px",fontSize:"16px",cursor:"pointer"},children:"Login with WAX"})]})}}},function(e){e.O(0,[664,888,774,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);