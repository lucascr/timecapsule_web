(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return a(7246)}])},7246:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return l}});var n=a(5893),r=a(3487),o=a(7294),s=a(1664),i=a.n(s);function l(){let{session:e,login:t,logout:a}=(0,r.k)(),[s,l]=(0,o.useState)(""),[c,d]=(0,o.useState)(""),[p,u]=(0,o.useState)(""),[h,g]=(0,o.useState)(""),[x,f]=(0,o.useState)(""),[y,m]=(0,o.useState)(""),[w,S]=(0,o.useState)(!1);(0,o.useEffect)(()=>{e&&v()},[e]);let v=async()=>{try{var t,a;if(!e||!e.actor)throw Error("Session or actor is not defined.");let n=null!==(a=null===(t=e.actor)||void 0===t?void 0:t.toString())&&void 0!==a?a:"default_actor",r=await b(n+" 0");console.log("Generated hash:",r);let o=await fetch("https://wax-testnet.eosphere.io/v1/chain/get_table_rows",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:"hashtesttest",scope:"hashtesttest",table:"idtable",index_position:"6",json:!0,key_type:"sha256",encode_type:"hex",upper_bound:r,lower_bound:r})}),s=await o.json();console.log("id:"+JSON.stringify(s,null,2)),s.rows&&s.rows.length>0?(S(!0),d(s.rows[0].id.toString())):(S(!1),d(""))}catch(e){console.error("Error checking available ID:",e),S(!1)}};async function b(e){let t=new TextEncoder().encode(e);return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>e.toString(16).padStart(2,"0")).join("")}let _=async()=>{if(e)try{let t={account:"hashtesttest",name:"generateid",authorization:[{actor:e.actor,permission:"active"}],data:{user:e.actor}};await e.transact({actions:[t]}),setTimeout(async()=>{await v()},5e3)}catch(e){console.error("Error generating ID:",e),alert("Failed to generate ID")}},j=(e,t)=>{if(!t)return e;let a=t.length,n="";for(let r=0;r<e.length;r++)n+=String.fromCharCode(e.charCodeAt(r)^t.charCodeAt(r%a));return n},k=e=>{let t=j(e,c);return btoa(String.fromCharCode(...new TextEncoder().encode(t)))},C=async()=>{if(!e||!s.trim())return;if(!c){alert("Please enter a password to encrypt your message");return}if(!p){alert("Please select a release date");return}let t=Math.floor(new Date(p).getTime()/1e3);Date.now();try{var a;let n=k(s.trim()),r={account:"hashtesttest",name:"sendmsg",authorization:[{actor:e.actor,permission:"active"}],data:{user:e.actor,message:n}},o=await e.transact({actions:[r]});if(!(null===(a=o.response)||void 0===a?void 0:a.transaction_id))throw Error("No transaction ID received");let i=o.response.transaction_id;console.log("Transaction hash:",i),console.log("Release_date:",t);let c={account:"hashtesttest",name:"saveid",authorization:[{actor:e.actor,permission:"active"}],data:{user:e.actor,str_hash:i.toString(),release_date:t}};await e.transact({actions:[c]}),l(""),u(""),d(""),S(!1),alert("Message sent successfully! Generate a new ID to send another message.")}catch(e){console.error("Error sending message:",e),alert("Failed to send message")}},D=new Date;D.setDate(D.getDate()+1);let E=D.toISOString().split("T")[0];return(0,n.jsxs)("div",{style:{padding:"20px"},children:[(0,n.jsx)("h1",{children:"TimeCapsule"}),e?(0,n.jsxs)("div",{children:[(0,n.jsxs)("p",{children:["Logged in as: ",e.actor.toString()]}),w?(0,n.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,n.jsx)("input",{type:"password",value:c,readOnly:!0,style:{width:"100%",padding:"10px",marginBottom:"10px",backgroundColor:"#f0f0f0"},placeholder:"Your ID hash..."}),(0,n.jsx)("textarea",{value:s,onChange:e=>l(e.target.value),style:{width:"100%",minHeight:"100px",padding:"10px",marginBottom:"10px"},placeholder:"Enter your message..."}),(0,n.jsxs)("div",{style:{marginBottom:"10px"},children:[(0,n.jsx)("label",{style:{display:"block",marginBottom:"5px"},children:"Release Date:"}),(0,n.jsx)("input",{type:"date",value:p,onChange:e=>u(e.target.value),min:E,style:{width:"100%",padding:"10px"}})]}),(0,n.jsxs)("div",{style:{display:"flex",gap:"10px"},children:[(0,n.jsx)("button",{onClick:C,style:{padding:"10px 20px",fontSize:"16px",cursor:"pointer"},children:"Send Message"}),(0,n.jsx)(i(),{href:"/messages",style:{padding:"10px 20px",fontSize:"16px",cursor:"pointer",backgroundColor:"#f0f0f0",textDecoration:"none",color:"black",display:"inline-block"},children:"View Messages"}),(0,n.jsx)("button",{onClick:a,style:{padding:"10px 20px",fontSize:"16px",cursor:"pointer"},children:"Logout"})]})]}):(0,n.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,n.jsx)("p",{children:"You need to generate an ID before sending messages"}),(0,n.jsxs)("div",{style:{display:"flex",gap:"10px"},children:[(0,n.jsx)("button",{onClick:_,style:{padding:"10px 20px",fontSize:"16px",cursor:"pointer"},children:"Generate ID"}),(0,n.jsx)(i(),{href:"/messages",style:{padding:"10px 20px",fontSize:"16px",cursor:"pointer",backgroundColor:"#f0f0f0",textDecoration:"none",color:"black",display:"inline-block"},children:"View Messages"})]})]}),!1]}):(0,n.jsx)("button",{onClick:t,style:{padding:"10px 20px",fontSize:"16px",cursor:"pointer"},children:"Login with WAX"})]})}}},function(e){e.O(0,[664,888,774,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);